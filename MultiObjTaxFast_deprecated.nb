(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     66224,       1632]
NotebookOptionsPosition[     61622,       1553]
NotebookOutlinePosition[     62247,       1576]
CellTagsIndexPosition[     62176,       1571]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["BigData Optimal Tax: Life-Cycle", "Title",
 CellChangeTimes->{{3.671198440491222*^9, 
  3.671198447962141*^9}},ExpressionUUID->"9de27387-93c0-4a24-b8ba-\
973e4b616126"],

Cell["\<\
This notebook takes the basic life cycle model and examines what happens for \
many alternative combinations of capital and labor tax rates.\
\>", "Text",
 CellChangeTimes->{{3.681564860171729*^9, 
  3.681564901250358*^9}},ExpressionUUID->"803e9a25-cae0-47c8-bf2c-\
1d21d41a42aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"x", "=", "0"}], ";", " ", 
  RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.5812531870091953`*^9, 3.581253200808003*^9}, {
  3.581299354377614*^9, 3.581299355290107*^9}, {3.801415044250848*^9, 
  3.801415046470849*^9}, {3.801415167189661*^9, 3.801415167809695*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"f8ca0cb2-d439-42f2-b2df-3596bb0e37fb"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"ecdb55e8-5b20-45bd-a245-ccb295e35ac0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<IPOPTLink`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"T", "=", "60"}], ";", 
   RowBox[{"Tret", "=", "45"}], ";"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r", "=", "0.1"}], ";", 
   RowBox[{"R", "=", 
    RowBox[{"1", " ", "+", " ", "r"}]}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Beta]", "=", ".95"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"u", "[", 
     RowBox[{"c_", ",", "l_"}], "]"}], " ", "=", 
    RowBox[{
     FractionBox[
      SuperscriptBox["c", 
       RowBox[{"1", "-", "\[Gamma]"}]], 
      RowBox[{"1", "-", "\[Gamma]"}]], "-", 
     RowBox[{"B", 
      FractionBox[
       SuperscriptBox["l", 
        RowBox[{"1", "+", "\[Eta]"}]], 
       RowBox[{"1", "+", "\[Eta]"}]]}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Specify", " ", "age"}], "-", 
    RowBox[{"wage", " ", "path"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"w", "[", "t", "]"}], "=", 
     RowBox[{
      RowBox[{"-", "36.9994"}], "+", 
      RowBox[{"3.52022", 
       RowBox[{"(", 
        RowBox[{"t", "+", "17"}], ")"}]}], "-", 
      RowBox[{".101878", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"t", "+", "17"}], ")"}], "2"]}], "+", 
      RowBox[{".00134816", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"t", "+", "17"}], ")"}], "3"]}], "-", 
      RowBox[{"7.06233", "*", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"t", "+", "17"}], ")"}], "4"]}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "1", ",", "Tret"}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"wagelist", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"i", "\[LessEqual]", " ", "Tret"}], ",", 
       RowBox[{"w", "[", "i", "]"}], ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "T"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Tax", "[", 
    RowBox[{"capInc_", ",", "labInc_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"\[Tau]K", " ", 
     RowBox[{"(", 
      RowBox[{"R", "-", "1"}], ")"}], " ", "capInc"}], "   ", "+", 
    RowBox[{"\[Tau]L", " ", "labInc"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PVrevL", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"\[Tau]L", " ", 
      RowBox[{"w", "[", "t", "]"}], " ", 
      RowBox[{"l", "[", "t", "]"}], " ", 
      SuperscriptBox["R", 
       RowBox[{
        RowBox[{"-", "t"}], "+", "1"}]]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", "Tret"}], "}"}]}], "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PVrevK", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"\[Tau]K", " ", 
      RowBox[{"(", 
       RowBox[{"R", "-", "1"}], ")"}], " ", 
      RowBox[{"a", "[", "t", "]"}], 
      SuperscriptBox["R", 
       RowBox[{
        RowBox[{"-", "t"}], "+", "1"}]]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PVrevC", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"\[Tau]C", " ", 
      RowBox[{"c", "[", "t", "]"}], " ", 
      SuperscriptBox["R", 
       RowBox[{
        RowBox[{"-", "t"}], "+", "1"}]]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"obj", " ", "=", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       SuperscriptBox["\[Beta]", 
        RowBox[{"t", "-", "1"}]], " ", 
       RowBox[{"u", "[", 
        RowBox[{
         RowBox[{"c", "[", "t", "]"}], ",", 
         RowBox[{"l", "[", "t", "]"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Define", " ", "Budget", " ", "Constraints"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"bc1", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"R", "  ", 
           RowBox[{"a", "[", "t", "]"}]}], "+", 
          RowBox[{
           RowBox[{"w", "[", "t", "]"}], " ", 
           RowBox[{"l", "[", "t", "]"}]}], "-", 
          RowBox[{"c", "[", "t", "]"}], "-", 
          RowBox[{"Tax", "[", " ", 
           RowBox[{
            RowBox[{"a", "[", "t", "]"}], ",", 
            RowBox[{
             RowBox[{"w", "[", "t", "]"}], " ", 
             RowBox[{"l", "[", "t", "]"}]}]}], "]"}]}], ")"}], "-", 
        RowBox[{"a", "[", 
         RowBox[{"t", "+", "1"}], "]"}]}], "\[GreaterEqual]", " ", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Define", " ", "bound", " ", "Constraints"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bcaT", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"T", "+", "1"}], "]"}], "\[GreaterEqual]", " ", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"abnds", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"a", "[", "t", "]"}], "\[GreaterEqual]", " ", "amin"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "2", ",", "T"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lbndsc", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"c", "[", "t", "]"}], "\[GreaterEqual]", " ", "0.0001"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lbndsl", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[GreaterEqual]", "0"}], "&"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"l", "[", "t", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "1", ",", "Tret"}], "}"}]}], "]"}]}], "]"}]}], 
   ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vars", ",", "varbounds"}], "}"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{"abnds", ",", "bcaT", ",", "lbndsc", ",", "lbndsl"}], " ", 
         "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"a_", "\[GreaterEqual]", " ", "b_"}], "  ", ")"}], " ", "->",
           " ", 
          RowBox[{"{", 
           RowBox[{"a", ",", "b", ",", "\[Infinity]"}], "}"}]}], "}"}]}], "//",
        "Transpose"}], ")"}], "/.", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v_", ",", "lb_", ",", "ub_"}], "}"}], "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{"v", ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"lb", ",", "ub"}], "}"}], "]"}]}], "}"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ipoptConstraintStyle", "=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{"a_", "==", " ", "b_"}], "  ", ")"}], " ", "->", " ", 
      RowBox[{"LessEqual", "[", 
       RowBox[{"0", ",", 
        RowBox[{"a", "-", "b"}], ",", "0"}], "]"}]}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{"a_", " ", "<=", "  ", "b_"}], " ", ")"}], " ", "->", " ", 
      RowBox[{"LessEqual", "[", 
       RowBox[{
        RowBox[{"-", "\[Infinity]"}], ",", 
        RowBox[{"a", "-", "b"}], ",", "0"}], "]"}]}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"a_", " ", ">=", " ", "b_"}], "  ", ")"}], " ", "->", " ", 
      RowBox[{"LessEqual", "[", 
       RowBox[{"0", ",", 
        RowBox[{"a", "-", "b"}], ",", "\[Infinity]"}], "]"}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"budgetconstraintfunctions", ",", "budgetconstraintvals"}], 
     "}"}], " ", "=", " ", 
    RowBox[{"Transpose", "[", 
     RowBox[{
      RowBox[{"bc1", " ", "/.", "ipoptConstraintStyle"}], "/.", " ", 
      RowBox[{
       RowBox[{"LessEqual", "[", 
        RowBox[{"lb_", ",", "v_", ",", "ub_"}], "]"}], "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"v", ",", 
         RowBox[{"{", 
          RowBox[{"lb", ",", "ub"}], "}"}]}], "}"}]}]}], " ", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Set", " ", "initial", " ", "guess", " ", "for", " ", "all", " ", 
     "variables", " ", "to", " ", "be", " ", "1"}], ";", " ", 
    RowBox[{
    "probably", " ", "not", " ", "a", " ", "feasible", " ", "point", " ", 
     "but", " ", "better", " ", "than", " ", "letting", " ", "them", " ", 
     "be", " ", 
     RowBox[{"zero", "."}]}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"varsinit", "=", 
    RowBox[{"Table", "[", 
     RowBox[{"1", ",", 
      RowBox[{"Length", "[", "vars", "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Define", " ", "border", " ", "conditions", " ", "particular", " ", "to", 
    " ", "the", " ", "problem"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"a", "[", "1", "]"}], "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"l", "[", "i", "]"}], "=", "0"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"Tret", "+", "1"}], ",", "T"}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"pfunc", " ", ":=", " ", 
   RowBox[{"ParametricIPOPTMinimize", "[", 
    RowBox[{
     RowBox[{"-", "obj"}], ",", "\[IndentingNewLine]", "\t\t\t\t\t\t", "vars",
      ",", "\[IndentingNewLine]", "\t\t\t\t\t\t", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"start", "[", "i", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", "\t\t\t\t\t\t", "varbounds", ",", 
     "\[IndentingNewLine]", "\t\t\t\t\t\t", "budgetconstraintfunctions", ",", 
     "\[IndentingNewLine]", "\t\t\t\t\t\t", "budgetconstraintvals", ",", 
     "\[IndentingNewLine]", "\t\t\t\t\t\t", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"start", "[", "i", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "\[Tau]K", ",", "\[Tau]L", ",", "amin", ",", "\[Gamma]", ",", 
         "\[Eta]", ",", "B"}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"initialguess_List", ",", "params_List"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "a", ",", "c", ",", "l", ",", "utility", ",", "PVrevK0", ",", "PVrevL0",
        ",", "\[Tau]K0", ",", "\[Tau]L0", ",", "amin0", ",", "\[Gamma]0", ",",
        "\[Eta]0", ",", "B0"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Tau]K0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Tau]L0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"amin0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Gamma]0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B0", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ipoptOut", " ", "=", " ", 
       RowBox[{"pfunc", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Join", "[", 
          RowBox[{"initialguess", ",", 
           RowBox[{"{", 
            RowBox[{
            "\[Tau]K0", ",", "\[Tau]L0", ",", "amin0", ",", "\[Gamma]0", ",", 
             "\[Eta]0", ",", "B0"}], "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", " ", 
       RowBox[{"IPOPTArgMin", "[", "ipoptOut", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"utility", " ", "=", " ", 
       RowBox[{"-", 
        RowBox[{"IPOPTMinValue", "[", "ipoptOut", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Sow", "[", 
       RowBox[{"{", 
        RowBox[{"utility", ",", "sol", ",", "\[Tau]K0", ",", "\[Tau]L0"}], 
        "}"}], "]"}], ";", "\[IndentingNewLine]", "sol"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"gamlist", "=", 
   RowBox[{"{", 
    RowBox[{"1", "/", "2"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"etalist", "=", 
   RowBox[{"{", "1", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"tkmax", "=", "0.4"}], ";", " ", 
  RowBox[{"tlmax", "=", "0.4"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"dtk", "=", "0.05"}], ";", " ", 
  RowBox[{"dtl", "=", "0.05"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ntk", "=", 
   RowBox[{
    RowBox[{"tkmax", "/", "dtk"}], "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ntl", "=", 
   RowBox[{
    RowBox[{"tlmax", "/", "dtl"}], " ", "+", " ", "1"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"possibilities", " ", "=", " ", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tk", ",", "tl", ",", "aamin", ",", "gam", ",", "eeta", ",", "n"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"tk", ",", "0", ",", "tkmax", ",", "dtk"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"tl", ",", "0", ",", "tlmax", ",", "dtl"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"aamin", ",", 
         RowBox[{"{", "0", "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"gam", ",", "gamlist"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"eeta", ",", "etalist"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"{", "1", "}"}]}], "}"}]}], "]"}], ",", "5"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"snake", "=", " ", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#2", "\[Equal]", "1"}], ",", 
          RowBox[{"Reverse", "[", "#1", "]"}], ",", "#1"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"possibilities", ",", 
           RowBox[{"Round", "[", "ntk", "]"}]}], "]"}], ",", 
         RowBox[{"1", "-", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"Round", "[", "ntk", "]"}], "]"}], ",", "2"}], "]"}]}]}],
         "}"}]}], "]"}], ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jobs", " ", "=", " ", 
   RowBox[{"Partition", "[", 
    RowBox[{"snake", ",", 
     RowBox[{"UpTo", "[", 
      RowBox[{"Ceiling", "[", 
       RowBox[{
        RowBox[{"Length", "[", "snake", "]"}], "/", "$ProcessorCount"}], 
       "]"}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7996440105370936`*^9, 3.7996440456581287`*^9}, {
   3.799644101392006*^9, 3.79964413294895*^9}, 3.7996461606381283`*^9, 
   3.79964625719018*^9, {3.799646320988411*^9, 3.799646360079564*^9}, {
   3.7996475594226346`*^9, 3.799647563705412*^9}, {3.799647708577279*^9, 
   3.7996477248369007`*^9}, {3.799647810366169*^9, 3.799647857298523*^9}, {
   3.799647888631339*^9, 3.799647935342759*^9}, {3.79964797698381*^9, 
   3.799648042704517*^9}, {3.7996481070045385`*^9, 3.7996481482354994`*^9}, {
   3.7996481944147882`*^9, 3.7996481950487914`*^9}, {3.799648277008055*^9, 
   3.799648402316766*^9}, {3.7996485045724463`*^9, 3.799648543830204*^9}, {
   3.799648902704544*^9, 3.799648969651144*^9}, {3.799649706673356*^9, 
   3.799649742984427*^9}, 3.7996498716710753`*^9, 3.801357043888917*^9, {
   3.801358537984662*^9, 3.801358597804652*^9}, 3.8014149137478523`*^9, 
   3.801415697807663*^9, 3.801416207262681*^9, {3.802318746358991*^9, 
   3.802318746711994*^9}, {3.8023190881714215`*^9, 3.8023190885644193`*^9}, 
   3.806763803986249*^9, {3.8069484154209466`*^9, 3.8069484162729464`*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"ce712d10-de08-4dcb-8ddd-9110e090f39f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"n", "=", "5"}], ";", 
     RowBox[{"k", "=", 
      RowBox[{
       RowBox[{"4", "\n", "lst"}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Range", "[", "n", "]"}], "\n", "b"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Mod", "[", 
           RowBox[{"n", ",", "k"}], "]"}], "\[IndentingNewLine]", "a"}], "=", 
         RowBox[{
          RowBox[{"k", "-", 
           RowBox[{"b", "\n", "s"}]}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Quotient", "[", 
             RowBox[{"n", ",", "k"}], "]"}], "\n", "small"}], "=", 
           RowBox[{"Take", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"lst", ",", "s"}], "]"}], ",", 
             RowBox[{
              RowBox[{"a", "\[IndentingNewLine]", "big"}], "=", 
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{"lst", ",", 
                  RowBox[{"a", " ", "s"}]}], "]"}], ",", 
                RowBox[{"s", "+", "1"}]}], "]"}]}]}]}]}]}]}]}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"BinBalanced", "[", 
    RowBox[{"possibilities", ",", "$ProcessorCount"}], "]"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"sequentialSolve", "[", "parametervals_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"pfunc", " ", ":=", " ", 
       RowBox[{"ParametricIPOPTMinimize", "[", 
        RowBox[{
         RowBox[{"-", "obj"}], ",", "\[IndentingNewLine]", "\t\t\t\t\t\t\t", 
         "vars", ",", "\[IndentingNewLine]", "\t\t\t\t\t\t\t", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"start", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", "\t\t\t\t\t\t\t", "varbounds", ",", 
         "\[IndentingNewLine]", "\t\t\t\t\t\t\t", "budgetconstraintfunctions",
          ",", "\[IndentingNewLine]", "\t\t\t\t\t\t\t", 
         "budgetconstraintvals", ",", "\[IndentingNewLine]", "\t\t\t\t\t\t\t", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"start", "[", "i", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "vars", "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "\[Tau]K", ",", "\[Tau]L", ",", "amin", ",", "\[Gamma]", ",", 
             "\[Eta]", ",", "B"}], "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Fold", "[", 
        RowBox[{"f", ",", "varsinit", ",", 
         RowBox[{"parametervals", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], "]"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"f", "[", 
        RowBox[{"varsinit", ",", 
         RowBox[{"parametervals", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Fold", "[", 
          RowBox[{"f", ",", "varsinit", ",", "parametervals"}], "]"}], "]"}], 
        "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], "\[IndentingNewLine]", 
   RowBox[{"outputs", " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"ParallelMap", "[", 
       RowBox[{"sequentialSolve", ",", "jobs"}], "]"}], ",", "1"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "jobs", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.7996440105370936`*^9, 3.7996440456581287`*^9}, {
   3.799644101392006*^9, 3.79964413294895*^9}, 3.7996461606381283`*^9, 
   3.79964625719018*^9, {3.799646320988411*^9, 3.799646360079564*^9}, {
   3.7996475594226346`*^9, 3.799647563705412*^9}, {3.799647708577279*^9, 
   3.7996477248369007`*^9}, {3.799647810366169*^9, 3.799647857298523*^9}, {
   3.799647888631339*^9, 3.799647935342759*^9}, {3.79964797698381*^9, 
   3.799648042704517*^9}, {3.7996481070045385`*^9, 3.7996481482354994`*^9}, {
   3.7996481944147882`*^9, 3.7996481950487914`*^9}, {3.799648277008055*^9, 
   3.799648402316766*^9}, {3.7996485045724463`*^9, 3.799648543830204*^9}, {
   3.799648902704544*^9, 3.799648969651144*^9}, {3.799649706673356*^9, 
   3.799649742984427*^9}, {3.799649876320451*^9, 3.7996498773774548`*^9}, {
   3.799649933015849*^9, 3.799649946851451*^9}, {3.7996769726877565`*^9, 
   3.7996769772830224`*^9}, {3.8013566310725574`*^9, 3.801356644347107*^9}, 
   3.8013567067701054`*^9, {3.8013569882328863`*^9, 3.801356989588892*^9}, 
   3.801357097324932*^9, 3.801357152696885*^9, {3.8013572686559286`*^9, 
   3.8013573066309004`*^9}, {3.8013573604559*^9, 3.8013573623528996`*^9}, {
   3.8013576553639383`*^9, 3.801357669164935*^9}, {3.801357709097949*^9, 
   3.801357734530946*^9}, {3.8013578144409475`*^9, 3.8013579088179483`*^9}, {
   3.801358040034498*^9, 3.801358079188498*^9}, {3.8013586194576607`*^9, 
   3.8013586595826545`*^9}, {3.8014149501778717`*^9, 
   3.8014149540308523`*^9}, {3.8014157871336946`*^9, 
   3.8014158019166937`*^9}, {3.801415873752666*^9, 3.8014158804716606`*^9}, {
   3.8014159786016626`*^9, 3.80141598015166*^9}, {3.8014160488256865`*^9, 
   3.8014161900416603`*^9}, 3.801416247802225*^9, {3.8014162792002764`*^9, 
   3.8014162934312215`*^9}, {3.8023187691979895`*^9, 3.802318769875998*^9}, {
   3.8023188014459906`*^9, 3.8023188031289945`*^9}, {3.8023189249308167`*^9, 
   3.802318958348346*^9}, {3.8067545712929277`*^9, 3.8067545724849243`*^9}, 
   3.8067637945032477`*^9},
 CellLabel->"In[84]:=",ExpressionUUID->"4dad17ca-90a1-42e5-a499-7ccdfec48ab3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"isAsset", "[", 
    RowBox[{"x_", "[", "_", "]"}], "]"}], " ", "=", 
   RowBox[{"x", " ", "==", "a"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"isAsset", ",", "Listable"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"assetsloc", " ", "=", " ", 
   RowBox[{"isAsset", "[", "vars", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"isLabor", "[", 
    RowBox[{"x_", "[", "_", "]"}], "]"}], " ", "=", 
   RowBox[{"x", " ", "==", "l"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"isLabor", ",", "Listable"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"laborloc", " ", "=", " ", 
   RowBox[{"isLabor", "[", "vars", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Rlist", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     SuperscriptBox["R", 
      RowBox[{
       RowBox[{"-", "t"}], "+", "1"}]], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", "T"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nicetablefast", "[", "outputrow_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"utility", ",", "solvals", ",", "tK", ",", "tL"}], " ", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"utility", " ", "=", " ", 
      RowBox[{"outputrow", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"solvals", "=", 
      RowBox[{"outputrow", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tK", "=", 
      RowBox[{"outputrow", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tL", " ", "=", 
      RowBox[{"outputrow", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"alist", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "0", "}"}], ",", 
        RowBox[{"Pick", "[", 
         RowBox[{"solvals", ",", "assetsloc"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"llist", " ", "=", " ", 
      RowBox[{"Pick", "[", 
       RowBox[{"solvals", ",", "laborloc"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PVrevLmod", " ", "=", " ", 
      RowBox[{"Total", "[", 
       RowBox[{"tL", " ", 
        RowBox[{"wagelist", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "Tret"}], "]"}], "]"}], " ", "llist", " ", 
        RowBox[{"Rlist", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "Tret"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PVrevKmod", " ", "=", " ", 
      RowBox[{"Total", "[", 
       RowBox[{"tK", 
        RowBox[{"(", 
         RowBox[{"R", "-", "1"}], ")"}], 
        RowBox[{"alist", " ", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "T"}], "]"}], "]"}], 
        RowBox[{"Rlist", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "T"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalPVrev", " ", "=", " ", 
      RowBox[{"PVrevLmod", " ", "+", " ", "PVrevKmod"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "utility", ",", "totalPVrev", ",", "PVrevLmod", ",", "PVrevKmod", 
           ",", "tK", ",", "tL"}], "}"}], "}"}], "}"}], "}"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", " ", "=", " ", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"ParallelMap", "[", 
      RowBox[{"nicetablefast", ",", "outputs"}], "]"}], ",", 
     RowBox[{"Round", "[", "ntk", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"data", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", "\[Equal]", "1"}], ",", 
            RowBox[{"Reverse", "[", "#1", "]"}], ",", "#1"}], "]"}], "&"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"data", ",", 
           RowBox[{"1", "-", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"Round", "[", "ntk", "]"}], "]"}], ",", "2"}], 
             "]"}]}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"]", "\[IndentingNewLine]", "data"}], " ", "=", " ", 
    RowBox[{"lifecycle", "[", 
     RowBox[{"60", ",", "45", ",", "0.1", ",", "0.95"}], "]"}]}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7996440105370936`*^9, 3.7996440456581287`*^9}, {
   3.799644101392006*^9, 3.79964413294895*^9}, 3.7996461606381283`*^9, 
   3.79964625719018*^9, {3.799646320988411*^9, 3.799646360079564*^9}, {
   3.7996475594226346`*^9, 3.799647563705412*^9}, {3.799647708577279*^9, 
   3.7996477248369007`*^9}, {3.799647810366169*^9, 3.799647857298523*^9}, {
   3.799647888631339*^9, 3.799647935342759*^9}, {3.79964797698381*^9, 
   3.799648042704517*^9}, {3.7996481070045385`*^9, 3.7996481482354994`*^9}, {
   3.7996481944147882`*^9, 3.7996481950487914`*^9}, {3.799648277008055*^9, 
   3.799648402316766*^9}, {3.7996485045724463`*^9, 3.799648543830204*^9}, {
   3.799648902704544*^9, 3.799648969651144*^9}, {3.799649706673356*^9, 
   3.799649742984427*^9}, {3.799649876320451*^9, 3.7996498773774548`*^9}, {
   3.799649933015849*^9, 3.799649946851451*^9}, {3.7996769726877565`*^9, 
   3.7996769814753094`*^9}, {3.799677165452528*^9, 3.799677195739002*^9}, {
   3.799677232466113*^9, 3.7996772496761403`*^9}, {3.7996775258403006`*^9, 
   3.7996775272972775`*^9}, {3.7996775601757154`*^9, 
   3.7996777445283957`*^9}, {3.801356658840106*^9, 3.801356662151106*^9}, {
   3.8013569410828886`*^9, 3.8013569677459393`*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"44bc20d3-bc24-4ad6-bdd8-d9772b011475"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"1a775d87-d104-4007-b2f5-67f25e8977bf"],

Cell["output data", "Text",
 CellChangeTimes->{{3.671099087523561*^9, 
  3.671099090546142*^9}},ExpressionUUID->"1a7d934e-3f07-4bb5-81b3-\
6bd311e427ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", ">>", " ", "dataoutMay2"}], ";"}]], "Input",
 CellChangeTimes->{{3.671100708672243*^9, 3.671100716928155*^9}, {
   3.671144785779805*^9, 3.671144787569378*^9}, {3.671236272087077*^9, 
   3.671236272854889*^9}, 3.67123639922649*^9},
 CellLabel->"In[71]:=",ExpressionUUID->"764b3757-2437-44ea-8e87-96c34b69d2e2"],

Cell["Next, we read the file", "Text",
 DefaultNewCellStyle->"Input",
 CellChangeTimes->{3.384246547981686*^9, 3.4306302836908607`*^9, 
  3.671140202975944*^9},
 CellTags->"b:4.2.1",ExpressionUUID->"c1ac7701-2e92-465b-86f6-89df9532eb6e"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "data", "]"}], "\n", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"<<", "dataoutMay2"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.67114479967033*^9, 3.671144803625003*^9}, 
   3.671198573054962*^9, {3.67123627579876*^9, 3.671236275894678*^9}},
 CellTags->"b:4.2.1",
 CellLabel->"In[72]:=",ExpressionUUID->"8f500b94-d332-4db3-8161-19a74bf2b0a3"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"e782005a-6fcf-4939-a347-9a1256ceb557"],

Cell[CellGroupData[{

Cell["The Pareto frontier - tables", "Section",
 CellChangeTimes->{{3.5816375016787786`*^9, 3.581637532282221*^9}, 
   3.671045141933819*^9, {3.681565600207574*^9, 3.681565602255783*^9}, {
   3.6815836671887093`*^9, 
   3.681583669765839*^9}},ExpressionUUID->"d69d1710-7f07-494a-8024-\
8fcdae97504b"],

Cell["\<\
In this notebook we care about utility versus revenue. I look forward to \
higher-dimensional frontiers.\
\>", "Text",
 CellChangeTimes->{{3.681565522610677*^9, 
  3.6815655799766283`*^9}},ExpressionUUID->"26237031-3a4e-4363-a567-\
e96095da2a14"],

Cell[CellGroupData[{

Cell["Define Pareto function and Pareto frontier", "Item",
 CellGroupingRules->{GroupTogetherGrouping, 10001.},
 CellChangeTimes->{{3.582210764249192*^9, 3.582210775141593*^9}, {
  3.582210923369351*^9, 
  3.582210948455326*^9}},ExpressionUUID->"94b953e7-0951-4ff3-8ca1-\
1001a3388d25"],

Cell["\<\
Function h receives:
\tData in from database of cases
\tTarget revenue
\tIndices - \[Gamma]ind and \[Eta]ind - indicating preference parameters

Function h outputs the optimal element for that revenue, and the policies \
that produced that outcome.\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10001.},
 CellChangeTimes->{{3.581637538646989*^9, 3.5816376455716753`*^9}, {
   3.582210760928245*^9, 3.582210762556411*^9}, 3.5822109233697*^9, 
   3.67105926494769*^9, {3.6815838194423637`*^9, 
   3.681583932407349*^9}},ExpressionUUID->"6f7cc13b-5619-40c5-81f2-\
516847746337"],

Cell[BoxData[
 RowBox[{
  RowBox[{"h", "[", 
   RowBox[{
   "data_", ",", "revenue_", ",", " ", "alimind_", ",", "\[Gamma]ind_", ",", 
    "\[Eta]ind_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dataflat", ",", "util", ",", "comb"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dataflat", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{
          "All", ",", "All", ",", "alimind", ",", "\[Gamma]ind", ",", 
           "\[Eta]ind", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"util", "=", 
      RowBox[{"Max", "[", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"dataflat", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", "revenue"}], 
           "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"comb", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"dataflat", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "==", "util"}], "&"}]}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10001.},
 CellChangeTimes->{{3.581560463985721*^9, 3.581560465683666*^9}, {
   3.581560565912147*^9, 3.58156057926252*^9}, {3.5815648134823103`*^9, 
   3.581564857233788*^9}, {3.581564938299243*^9, 3.581564972521599*^9}, {
   3.581565046382269*^9, 3.581565049661147*^9}, {3.581565376428838*^9, 
   3.581565376824786*^9}, {3.581565859442895*^9, 3.581565945950294*^9}, {
   3.58156599668439*^9, 3.581565998180482*^9}, {3.5815662776939917`*^9, 
   3.581566278658383*^9}, {3.581566542039432*^9, 3.5815665477412643`*^9}, {
   3.5815671503867188`*^9, 3.581567157103455*^9}, {3.58160361220184*^9, 
   3.581603614886895*^9}, {3.581885481638482*^9, 3.581885481787155*^9}, {
   3.581885633794683*^9, 3.5818856340567503`*^9}, {3.581957153438487*^9, 
   3.581957181493322*^9}, {3.581957352282049*^9, 3.5819574268008823`*^9}, {
   3.5819574985186577`*^9, 3.581957589451078*^9}, {3.581957659140811*^9, 
   3.581957663348247*^9}, {3.581957737843943*^9, 3.5819577418355217`*^9}, {
   3.581957806267538*^9, 3.581957878112668*^9}, {3.581983173445075*^9, 
   3.581983208713488*^9}, {3.582210789100047*^9, 3.582210796932034*^9}, 
   3.5822109233699913`*^9, 3.671045152678851*^9, 3.671060215816697*^9},
 CellLabel->"In[74]:=",ExpressionUUID->"f46c4644-780f-455b-be24-3277f13be630"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"casesprefs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"gamlist", "[", 
        RowBox[{"[", "gam", "]"}], "]"}], ",", 
       RowBox[{"etalist", "[", 
        RowBox[{"[", "eeta", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"gam", ",", "1", ",", 
       RowBox[{"Length", "[", "gamlist", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"eeta", ",", "1", ",", 
       RowBox[{"Length", "[", "gamlist", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"casesprefs", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"casesprefs", ",", "1"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6710591521612883`*^9, 3.671059198126001*^9}, {
   3.6710592848833847`*^9, 3.671059430079183*^9}, {3.67105957079641*^9, 
   3.671059571130836*^9}, {3.671059755157048*^9, 3.671059758428932*^9}, {
   3.6710658182837143`*^9, 3.6710658571623707`*^9}, {3.671106590921137*^9, 
   3.671106649381027*^9}, 3.6712091882426367`*^9},
 CellLabel->"In[75]:=",ExpressionUUID->"acc99b1a-8454-41f1-868b-496fd9893ca6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cases", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "gam", ",", "eeta"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"gam", ",", "1", ",", 
       RowBox[{"Length", "[", "gamlist", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"eeta", ",", "1", ",", 
       RowBox[{"Length", "[", "gamlist", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cases", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"cases", ",", "1"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6710591521612883`*^9, 3.671059198126001*^9}, {
   3.6710592848833847`*^9, 3.671059430079183*^9}, {3.67105957079641*^9, 
   3.671059571130836*^9}, {3.671059755157048*^9, 3.671059758428932*^9}, {
   3.6710658182837143`*^9, 3.6710658571623707`*^9}, {3.6711985923414183`*^9, 
   3.671198595805244*^9}, 3.671209193682439*^9},
 CellLabel->"In[77]:=",ExpressionUUID->"ecfbccdf-56d0-4bb1-b673-e5116ddbae9b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"numcases", "=", 
   RowBox[{"Length", "[", "cases", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"count", "=", "0"}], ";"}]}], "Input",
 CellChangeTimes->{{3.671065870829756*^9, 3.6710658776176033`*^9}, {
   3.6711986210763893`*^9, 3.6711986214048653`*^9}, 3.671209198570552*^9},
 CellLabel->"In[79]:=",ExpressionUUID->"c105635c-39ec-4beb-99d5-1f0caf1cd2a0"],

Cell[BoxData[
 RowBox[{"outcmd", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"count", "=", 
     RowBox[{"count", "+", "1"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "k"}], "}"}], "=", 
     RowBox[{"cases", "[", 
      RowBox[{"[", "count", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"\"\<gamma = \>\"", ",", 
       RowBox[{
        RowBox[{"casesprefs", "[", 
         RowBox[{"[", "count", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,   eta = \>\"", ",", 
       RowBox[{
        RowBox[{"casesprefs", "[", 
         RowBox[{"[", "count", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"maxrev", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{
             "All", ",", "All", ",", "i", ",", "j", ",", "k", ",", "1"}], 
             "]"}], "]"}], ",", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//", "Max"}]}]}], ";", "\n", 
    RowBox[{"tb", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{"data", ",", "rev", ",", "i", ",", "j", ",", "k"}], "]"}], 
        "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"rev", ",", "0", ",", 
         RowBox[{"0.99", " ", "maxrev"}], " ", ",", 
         RowBox[{"0.04", " ", "maxrev"}]}], "}"}]}], "]"}]}], ";", "\n", 
    RowBox[{"TableForm", "[", 
     RowBox[{"tb", ",", 
      RowBox[{"TableHeadings", "->", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "\"\<util\>\"", ",", "\"\<revtot\>\"", ",", "\"\<revk\>\"", ",", 
           "\"\<revl\>\"", ",", "\"\<tk\>\"", ",", "\"\<tl\>\""}], "}"}]}], 
        "}"}]}]}], "]"}]}], ")"}]}]], "Input",
 CellChangeTimes->{{3.671027246228043*^9, 3.671027276811471*^9}, {
   3.671027322730132*^9, 3.671027385759548*^9}, {3.67102769331037*^9, 
   3.671027722923544*^9}, {3.6710282373134203`*^9, 3.671028239024637*^9}, {
   3.671037087204837*^9, 3.671037096306945*^9}, {3.671037155864705*^9, 
   3.671037183815483*^9}, {3.6710374073278313`*^9, 3.671037422527129*^9}, {
   3.671037479118601*^9, 3.6710374815975924`*^9}, {3.6710531399456053`*^9, 
   3.671053181655106*^9}, {3.6710543154667053`*^9, 3.671054332473147*^9}, {
   3.6710545980570507`*^9, 3.671054619176004*^9}, 3.671059587954618*^9, {
   3.67106619722477*^9, 3.671066259254092*^9}, {3.671139347244005*^9, 
   3.671139494775463*^9}, {3.671139719751594*^9, 3.6711397324312687`*^9}, {
   3.671168620225584*^9, 3.671168621047823*^9}, 3.671170613821347*^9, {
   3.67117066795473*^9, 3.671170669722687*^9}, {3.671170852493124*^9, 
   3.671170887660295*^9}, 3.671171268753079*^9, {3.67117174899517*^9, 
   3.6711717503226347`*^9}, {3.671172127216404*^9, 3.671172127736096*^9}, {
   3.671362733122407*^9, 3.671362736376039*^9}, {3.671362808112771*^9, 
   3.67136291371243*^9}, {3.675003647640397*^9, 3.675003653241075*^9}, 
   3.675003977353194*^9, {3.675004245853261*^9, 3.675004248340067*^9}, {
   3.675591101787465*^9, 3.675591102274148*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"69c36c8f-047d-45b7-9920-fced3daf8113"],

Cell[BoxData[
 RowBox[{"outcmdold", ":=", " ", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"count", "=", 
     RowBox[{"count", "+", "1"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "k"}], "}"}], "=", 
     RowBox[{"cases", "[", 
      RowBox[{"[", "count", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"\"\<gamma = \>\"", ",", 
       RowBox[{
        RowBox[{"casesprefs", "[", 
         RowBox[{"[", "count", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,   eta = \>\"", ",", 
       RowBox[{
        RowBox[{"casesprefs", "[", 
         RowBox[{"[", "count", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"maxrev", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{
             "All", ",", "All", ",", "i", ",", "j", ",", "k", ",", "1"}], 
             "]"}], "]"}], ",", "1"}], "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//", "Max"}]}]}], ";", "\n", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{"data", ",", "rev", ",", "i", ",", "j", ",", "k"}], "]"}], 
        "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"rev", ",", "0", ",", 
         RowBox[{"0.96", " ", "maxrev"}], " ", ",", 
         RowBox[{"0.02", " ", "maxrev"}]}], "}"}]}], "]"}], "//", 
     "TableForm"}]}], ")"}]}]], "Input",
 CellChangeTimes->{{3.671027246228043*^9, 3.671027276811471*^9}, {
   3.671027322730132*^9, 3.671027385759548*^9}, {3.67102769331037*^9, 
   3.671027722923544*^9}, {3.6710282373134203`*^9, 3.671028239024637*^9}, {
   3.671037087204837*^9, 3.671037096306945*^9}, {3.671037155864705*^9, 
   3.671037183815483*^9}, {3.6710374073278313`*^9, 3.671037422527129*^9}, {
   3.671037479118601*^9, 3.6710374815975924`*^9}, {3.6710531399456053`*^9, 
   3.671053181655106*^9}, {3.6710543154667053`*^9, 3.671054332473147*^9}, {
   3.6710545980570507`*^9, 3.671054619176004*^9}, 3.671059587954618*^9, {
   3.67106619722477*^9, 3.671066259254092*^9}, {3.671139347244005*^9, 
   3.671139494775463*^9}, {3.671139719751594*^9, 3.6711397324312687`*^9}, {
   3.671168620225584*^9, 3.671168621047823*^9}, {3.6711986413958693`*^9, 
   3.671198641979827*^9}, 3.67120285129668*^9, {3.671208526691906*^9, 
   3.671208569072488*^9}, 3.671209089535039*^9, 3.675002962135284*^9, {
   3.675003662751278*^9, 3.675003663735531*^9}, {3.6750042320502*^9, 
   3.675004241979177*^9}, {3.67539135991218*^9, 3.6753913690073967`*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"9300a6ed-6cde-49be-9ae5-dcd2f36d598d"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"ca1aaa8d-5fc8-433f-91dc-9d9c8da07b5b"],

Cell[BoxData["outcmd"], "Input",
 CellChangeTimes->{{3.671208582989839*^9, 3.671208599312229*^9}, 
   3.6712086436238317`*^9},
 CellLabel->"In[83]:=",ExpressionUUID->"0de25889-06e1-4c7a-b9d8-ab1512a3bf59"]
}, Open  ]],

Cell[CellGroupData[{

Cell["The Pareto frontier - graphs", "Section",
 CellChangeTimes->{{3.5816375016787786`*^9, 3.581637532282221*^9}, 
   3.671045141933819*^9, {3.681565600207574*^9, 3.681565624254918*^9}, {
   3.6815839497910013`*^9, 
   3.681583953278905*^9}},ExpressionUUID->"d03cc38f-093b-4037-9c0d-\
f4b43dae5a28"],

Cell[CellGroupData[{

Cell["Plot all data", "Subsection",
 CellChangeTimes->{{3.681565689948266*^9, 
  3.681565692212309*^9}},ExpressionUUID->"025830dc-1aa0-495a-9011-\
5b80219e1cd8"],

Cell["\<\
We plot all the data points in revenue-utility space. This helps us see where \
the good points are. I also use colors to indicate the policies.\
\>", "Text",
 CellChangeTimes->{{3.681583973241487*^9, 
  3.681584013246958*^9}},ExpressionUUID->"33948695-2db0-43b7-90f4-\
5489c90affd9"],

Cell["plot", "Item",
 CellGroupingRules->{GroupTogetherGrouping, 10002.},
 CellChangeTimes->{{3.58216638930646*^9, 
  3.582166408868449*^9}},ExpressionUUID->"e0f067d0-4f02-4f65-8c87-\
c6e823b388b4"],

Cell[BoxData[
 RowBox[{"tmax", "=", 
  RowBox[{"Max", "[", 
   RowBox[{"tkmax", ",", "tlmax"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.759082096886919*^9, 3.7590821040883408`*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"e67867cc-f0ba-48fd-bde2-d4841b1b608e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plot", "[", 
   RowBox[{"alimind_", ",", "\[Gamma]ind_", ",", "\[Eta]ind_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"alimi", "=", "alimind"}], ",", 
      RowBox[{"\[Gamma]i", "=", "\[Gamma]ind"}], ",", 
      RowBox[{"\[Eta]i", "=", "\[Eta]ind"}], ",", 
      RowBox[{"\[CapitalBeta]i", "=", "1"}], ",", "dots", ",", "colorF", ",", 
      "gra1", ",", "gra2", ",", "plotLegend", ",", "leg"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dots", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{
          "All", ",", "All", ",", "alimi", ",", "\[Gamma]i", ",", "\[Eta]i", 
           ",", "\[CapitalBeta]i"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"colorF", "=", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "Green"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"tmax", ",", "Red"}], "}"}]}], "}"}], ",", "#"}], "]"}], 
       "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"gra1", "=", 
      RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"colorF", "[", "#5", "]"}], ",", 
              RowBox[{"Tooltip", "[", 
               RowBox[{
                RowBox[{"Point", "[", 
                 RowBox[{"{", 
                  RowBox[{"#2", ",", "#1"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"#5", ",", "#6"}], "}"}]}], "]"}]}], "}"}], "&"}], "@@@",
            "dots"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{"\"\<\[Tau]K\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"dots", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "/", "2"}], 
              ",", 
              RowBox[{"Max", "[", 
               RowBox[{"dots", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"PlotRange", "\[Rule]", "All"}], ",", "\[IndentingNewLine]", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"FrameLabel", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Total Tax Revenue\>\"", ",", "\"\<Consumer Utility\>\""}], 
          "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"AxesOrigin", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"gra2", "=", 
      RowBox[{"Graphics", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"colorF", "[", "#6", "]"}], ",", 
              RowBox[{"Tooltip", "[", 
               RowBox[{
                RowBox[{"Point", "[", 
                 RowBox[{"{", 
                  RowBox[{"#2", ",", "#1"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"#5", ",", "#6"}], "}"}]}], "]"}]}], "}"}], "&"}], "@@@",
            "dots"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{"\"\<\[Tau]L\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{"dots", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "/", "2"}], 
              ",", 
              RowBox[{"Max", "[", 
               RowBox[{"dots", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], ",", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Total Tax Revenue\>\"", ",", "\"\<Consumer Utility\>\""}], 
          "}"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"plotLegend", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"min_", ",", "max_"}], "}"}], ",", "n_", ",", "col_"}], 
       "]"}], ":=", 
      RowBox[{"Graphics", "[", 
       RowBox[{
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"col", "[", "#1", "]"}], ",", 
               RowBox[{"Rectangle", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"Black", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"NumberForm", "[", 
                  RowBox[{
                   RowBox[{"N", "@", "#1"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"4", ",", "2"}], "}"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"4", ",", 
                   RowBox[{
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", ".5"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], "}"}]}], "}"}], 
           "&"}], ",", 
          RowBox[{"Rescale", "[", 
           RowBox[{
            RowBox[{"Range", "[", "n", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"min", ",", "max"}], "}"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameTicks", "\[Rule]", "None"}], ",", 
        RowBox[{"PlotRangePadding", "\[Rule]", ".5"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"leg", "=", 
      RowBox[{"plotLegend", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0.8"}], "}"}], ",", "20", ",", "colorF"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Grid", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{"\"\<\[Gamma]= \>\"", ",", 
              SuperscriptBox["2", 
               RowBox[{"\[Gamma]i", "-", "2"}]], ",", " ", 
              "\"\<, \[Eta]= \>\"", ",", 
              RowBox[{"Piecewise", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"10", ",", 
                    RowBox[{"\[Eta]i", "\[Equal]", "4"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"5", ",", 
                    RowBox[{"\[Eta]i", "\[Equal]", "3"}]}], "}"}]}], "}"}], 
                ",", "\[Eta]i"}], " ", "]"}], " ", ",", " ", 
              "\"\<, Borrowinglimit= \>\"", ",", 
              RowBox[{"Piecewise", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"alimi", "-", "1"}], ")"}]}], "*", "10"}], ",", 
                    RowBox[{"alimi", "<", "4"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "50"}], ",", 
                    RowBox[{"alimi", "\[Equal]", "4"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"-", "\[Infinity]"}]}], "]"}]}], "}"}], "]"}], ",", 
           "SpanFromLeft"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"gra1", ",", "gra2", ",", "leg"}], "}"}]}], "}"}], ",", 
       RowBox[{"ItemSize", "\[Rule]", "Automatic"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10002.},
 CellChangeTimes->{{3.581983086458713*^9, 3.581983106397264*^9}, {
   3.5819832852521877`*^9, 3.581983341520281*^9}, {3.58198338223318*^9, 
   3.581983489263132*^9}, {3.581983523873568*^9, 3.581983582010233*^9}, {
   3.5819836506120853`*^9, 3.581983668512216*^9}, {3.581983735931644*^9, 
   3.5819837757669086`*^9}, {3.58198388971763*^9, 3.581983897292616*^9}, {
   3.581983930391822*^9, 3.581984081451326*^9}, {3.581984117944892*^9, 
   3.581984142130522*^9}, {3.581984555054446*^9, 3.581984568810657*^9}, {
   3.581992833846451*^9, 3.581992844140896*^9}, {3.581993750772365*^9, 
   3.5819937519632072`*^9}, {3.5819938367011003`*^9, 3.581993987285858*^9}, {
   3.5819943297455797`*^9, 3.581994338751872*^9}, {3.5819944119744577`*^9, 
   3.581994598420631*^9}, {3.581994673696684*^9, 3.5819946757771072`*^9}, {
   3.581996160779861*^9, 3.58199616567752*^9}, {3.582164464648631*^9, 
   3.582164522130664*^9}, {3.582164589593195*^9, 3.5821646397231817`*^9}, {
   3.582164715924797*^9, 3.582164735545018*^9}, {3.582164868760666*^9, 
   3.582164876407002*^9}, {3.582164942985579*^9, 3.5821650240074577`*^9}, {
   3.582165060679635*^9, 3.5821650955368547`*^9}, {3.582165348572537*^9, 
   3.5821653692497168`*^9}, {3.582165400312148*^9, 3.5821654328887587`*^9}, {
   3.582165546195743*^9, 3.58216571792148*^9}, {3.582166204704718*^9, 
   3.582166341151449*^9}, 3.582166399017908*^9, {3.582169139945836*^9, 
   3.582169229648994*^9}, {3.582169352292098*^9, 3.582169365214905*^9}, {
   3.58216967044096*^9, 3.582169729855114*^9}, {3.582209004196089*^9, 
   3.5822090615527887`*^9}, 3.671098687645939*^9, {3.681564181373654*^9, 
   3.6815642100798817`*^9}, {3.756674293192327*^9, 3.756674294923699*^9}, {
   3.759082109070359*^9, 3.759082111715495*^9}, {3.798744320086513*^9, 
   3.798744324076098*^9}, {3.798744408509397*^9, 3.798744412277729*^9}, {
   3.7987447108681498`*^9, 3.7987447255681467`*^9}, {3.798744787698504*^9, 
   3.798744793282064*^9}, {3.798744824598618*^9, 3.798744847637101*^9}, {
   3.798744920290173*^9, 3.798744931124468*^9}, 3.7987451226400843`*^9},
 CellLabel->"In[85]:=",ExpressionUUID->"815d61fd-abb1-4368-a82e-f032f2d82488"],

Cell[BoxData[
 RowBox[{
  RowBox[{"count", "=", "0"}], ";"}]], "Input",
 CellChangeTimes->{{3.671097697977021*^9, 3.671097701731737*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"bb37778a-1c4c-4a70-8d92-23e73628fa82"],

Cell[BoxData[
 RowBox[{"prntcmd", ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"count", "=", 
     RowBox[{"count", "+", "1"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "k"}], "}"}], "=", 
     RowBox[{"cases", "[", 
      RowBox[{"[", "count", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<gamma = \>\"", ",", 
      RowBox[{
       RowBox[{"casesprefs", "[", 
        RowBox[{"[", "count", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,   eta = \>\"", ",", 
      RowBox[{
       RowBox[{"casesprefs", "[", 
        RowBox[{"[", "count", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"plot", "[", 
     RowBox[{"i", ",", "j", ",", "k"}], "]"}]}], ")"}]}]], "Input",
 CellChangeTimes->{{3.671027246228043*^9, 3.671027276811471*^9}, {
   3.671027322730132*^9, 3.671027385759548*^9}, {3.67102769331037*^9, 
   3.671027722923544*^9}, {3.6710282373134203`*^9, 3.671028239024637*^9}, {
   3.671037087204837*^9, 3.671037096306945*^9}, {3.671037155864705*^9, 
   3.671037183815483*^9}, {3.6710374073278313`*^9, 3.671037422527129*^9}, {
   3.671037479118601*^9, 3.6710374815975924`*^9}, {3.6710531399456053`*^9, 
   3.671053181655106*^9}, {3.6710543154667053`*^9, 3.671054332473147*^9}, {
   3.6710545980570507`*^9, 3.671054619176004*^9}, 3.671059587954618*^9, {
   3.67106619722477*^9, 3.671066259254092*^9}, {3.6710977092277613`*^9, 
   3.671097732946793*^9}, {3.671098149580461*^9, 3.671098151221958*^9}, 
   3.67114456117177*^9, {3.6712087179253902`*^9, 3.6712087423469*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"b99c0e01-3f95-4320-8002-a166ee2818a9"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"0e0b9ab6-3f89-4c99-b825-4a40880ccea2"],

Cell["\<\
Each plot is a point in utility-revenue space. The left one uses color to \
indicate the size of the capital income tax; the right one does so for the \
labor income tax.
Note that there are some red points in the \[Tau]L graph that are on the \
frontier, but the red points in the \[Tau]K graph are all inferior.\
\>", "Text",
 CellChangeTimes->{{3.6815840364001923`*^9, 
  3.681584151372305*^9}},ExpressionUUID->"377661a7-7bc4-41ea-ba1b-\
12ea15b6d697"],

Cell[BoxData["prntcmd"], "Input",
 CellChangeTimes->{{3.671208750478533*^9, 3.671208751570168*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"666a9ca6-0ee5-4add-bfb7-22d2dc2f61b0"],

Cell[BoxData["time"], "Input",
 CellChangeTimes->{{3.799524932685895*^9, 3.799524933750865*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"43e020f5-a6d4-45e1-a969-0db3f5d61e87"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1258, 964},
WindowMargins->{{31, Automatic}, {Automatic, 2}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "b:4.2.1"->{
  Cell[31133, 824, 237, 4, 34, "Text",ExpressionUUID->"c1ac7701-2e92-465b-86f6-89df9532eb6e",
   CellTags->"b:4.2.1"],
  Cell[31373, 830, 384, 8, 48, "Input",ExpressionUUID->"8f500b94-d332-4db3-8161-19a74bf2b0a3",
   CellTags->"b:4.2.1"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"b:4.2.1", 61913, 1563}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 174, 3, 96, "Title",ExpressionUUID->"9de27387-93c0-4a24-b8ba-973e4b616126"],
Cell[757, 27, 290, 6, 34, "Text",ExpressionUUID->"803e9a25-cae0-47c8-bf2c-1d21d41a42aa"],
Cell[1050, 35, 421, 7, 28, "Input",ExpressionUUID->"f8ca0cb2-d439-42f2-b2df-3596bb0e37fb"],
Cell[1474, 44, 99, 1, 4, "PageBreak",ExpressionUUID->"ecdb55e8-5b20-45bd-a245-ccb295e35ac0",
 PageBreakBelow->True],
Cell[1576, 47, 16911, 475, 1273, "Input",ExpressionUUID->"ce712d10-de08-4dcb-8ddd-9110e090f39f"],
Cell[18490, 524, 5917, 129, 409, "Input",ExpressionUUID->"4dad17ca-90a1-42e5-a499-7ccdfec48ab3"],
Cell[24410, 655, 6107, 151, 452, "Input",ExpressionUUID->"44bc20d3-bc24-4ad6-bdd8-d9772b011475"],
Cell[30520, 808, 99, 1, 1, "PageBreak",ExpressionUUID->"1a775d87-d104-4007-b2f5-67f25e8977bf",
 PageBreakBelow->True],
Cell[30622, 811, 153, 3, 34, "Text",ExpressionUUID->"1a7d934e-3f07-4bb5-81b3-6bd311e427ab"],
Cell[30778, 816, 352, 6, 28, "Input",ExpressionUUID->"764b3757-2437-44ea-8e87-96c34b69d2e2"],
Cell[31133, 824, 237, 4, 34, "Text",ExpressionUUID->"c1ac7701-2e92-465b-86f6-89df9532eb6e",
 CellTags->"b:4.2.1"],
Cell[31373, 830, 384, 8, 48, "Input",ExpressionUUID->"8f500b94-d332-4db3-8161-19a74bf2b0a3",
 CellTags->"b:4.2.1"],
Cell[31760, 840, 99, 1, 1, "PageBreak",ExpressionUUID->"e782005a-6fcf-4939-a347-9a1256ceb557",
 PageBreakBelow->True],
Cell[CellGroupData[{
Cell[31884, 845, 300, 5, 67, "Section",ExpressionUUID->"d69d1710-7f07-494a-8024-8fcdae97504b"],
Cell[32187, 852, 256, 6, 34, "Text",ExpressionUUID->"26237031-3a4e-4363-a567-e96095da2a14"],
Cell[CellGroupData[{
Cell[32468, 862, 286, 5, 31, "Item",ExpressionUUID->"94b953e7-0951-4ff3-8ca1-1001a3388d25",
 CellGroupingRules->{GroupTogetherGrouping, 10001.}],
Cell[32757, 869, 597, 14, 144, "Text",ExpressionUUID->"6f7cc13b-5619-40c5-81f2-516847746337",
 CellGroupingRules->{GroupTogetherGrouping, 10001.}],
Cell[33357, 885, 2705, 59, 124, "Input",ExpressionUUID->"f46c4644-780f-455b-be24-3277f13be630",
 CellGroupingRules->{GroupTogetherGrouping, 10001.}]
}, Open  ]],
Cell[36077, 947, 1130, 27, 48, "Input",ExpressionUUID->"acc99b1a-8454-41f1-868b-496fd9893ca6"],
Cell[37210, 976, 989, 23, 48, "Input",ExpressionUUID->"ecfbccdf-56d0-4bb1-b673-e5116ddbae9b"],
Cell[38202, 1001, 409, 8, 48, "Input",ExpressionUUID->"c105635c-39ec-4beb-99d5-1f0caf1cd2a0"],
Cell[38614, 1011, 3431, 75, 124, "Input",ExpressionUUID->"69c36c8f-047d-45b7-9920-fced3daf8113"],
Cell[42048, 1088, 2876, 62, 124, "Input",ExpressionUUID->"9300a6ed-6cde-49be-9ae5-dcd2f36d598d"],
Cell[44927, 1152, 99, 1, 1, "PageBreak",ExpressionUUID->"ca1aaa8d-5fc8-433f-91dc-9d9c8da07b5b",
 PageBreakBelow->True],
Cell[45029, 1155, 205, 3, 28, "Input",ExpressionUUID->"0de25889-06e1-4c7a-b9d8-ab1512a3bf59"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45271, 1163, 300, 5, 67, "Section",ExpressionUUID->"d03cc38f-093b-4037-9c0d-f4b43dae5a28"],
Cell[CellGroupData[{
Cell[45596, 1172, 161, 3, 53, "Subsection",ExpressionUUID->"025830dc-1aa0-495a-9011-5b80219e1cd8"],
Cell[45760, 1177, 294, 6, 34, "Text",ExpressionUUID->"33948695-2db0-43b7-90f4-5489c90affd9"],
Cell[46057, 1185, 198, 4, 31, "Item",ExpressionUUID->"e0f067d0-4f02-4f65-8c87-c6e823b388b4",
 CellGroupingRules->{GroupTogetherGrouping, 10002.}],
Cell[46258, 1191, 261, 5, 28, "Input",ExpressionUUID->"e67867cc-f0ba-48fd-bde2-d4841b1b608e"],
Cell[46522, 1198, 12146, 286, 601, "Input",ExpressionUUID->"815d61fd-abb1-4368-a82e-f032f2d82488",
 CellGroupingRules->{GroupTogetherGrouping, 10002.}],
Cell[58671, 1486, 216, 4, 28, "Input",ExpressionUUID->"bb37778a-1c4c-4a70-8d92-23e73628fa82"],
Cell[58890, 1492, 1763, 34, 105, "Input",ExpressionUUID->"b99c0e01-3f95-4320-8002-a166ee2818a9"],
Cell[60656, 1528, 99, 1, 4, "PageBreak",ExpressionUUID->"0e0b9ab6-3f89-4c99-b825-4a40880ccea2",
 PageBreakBelow->True],
Cell[60758, 1531, 465, 9, 56, "Text",ExpressionUUID->"377661a7-7bc4-41ea-ba1b-12ea15b6d697"],
Cell[61226, 1542, 178, 2, 28, "Input",ExpressionUUID->"666a9ca6-0ee5-4add-bfb7-22d2dc2f61b0"],
Cell[61407, 1546, 175, 2, 28, "Input",ExpressionUUID->"43e020f5-a6d4-45e1-a969-0db3f5d61e87"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

